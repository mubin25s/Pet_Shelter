<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Login - Paws Shelter</title>
    <link rel="stylesheet" href="css/petshelder.css">
</head>
<body>
    <div class="container">
        <div class="auth-container">
            <div class="login-tabs">
                <button class="tab-btn active" onclick="switchTab('user')">User Access</button>
                <button class="tab-btn" onclick="switchTab('admin')">Admin Access</button>
            </div>
            
            <h2 id="login-title">Welcome Back! üêæ</h2>
            <div id="error-msg" style="color:red; margin-bottom:10px;"></div>
            
            <form id="loginForm">
                <div class="form-group">
                    <label>Email Address</label>
                    <input type="email" id="email" required>
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="password" required>
                </div>
                <button type="submit" class="btn btn-primary" style="width:100%">Login</button>
            </form>
            <div class="switch-link" id="register-link">New to Paws? <a href="register.html">Create an account</a></div>
            <div class="switch-link"><a href="index.html">Back to Home</a></div>
        </div>
    </div>
    <script src="js/pet.js"></script>
    <script>
        let currentRole = 'user';

        function switchTab(role) {
            currentRole = role;
            const buttons = document.querySelectorAll('.tab-btn');
            const title = document.getElementById('login-title');
            const regLink = document.getElementById('register-link');
            const form = document.getElementById('loginForm');
            
            document.getElementById('error-msg').innerText = ''; // Clear errors
            
            if (role === 'admin') {
                buttons[0].classList.remove('active');
                buttons[1].classList.add('active');
                title.innerText = 'Admin Portal üîí';
                regLink.style.display = 'none';
            } else {
                buttons[0].classList.add('active');
                buttons[1].classList.remove('active');
                title.innerText = 'Welcome Back! üêæ';
                regLink.style.display = 'block';
            }
        }

        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const errorDiv = document.getElementById('error-msg');
            
            const res = await apiCall('auth.php?action=login', 'POST', { email, password });
            
            if (res.success) {
                const targetDash = (currentRole === 'admin' && res.role === 'admin') ? 'admin_dashboard.html' : 'user_dashboard.html';
                
                if (currentRole === 'admin' && res.role !== 'admin') {
                     errorDiv.innerHTML = 'Access Denied: You are not an administrator.';
                     apiCall('auth.php?action=logout');
                } else {
                    window.location.href = targetDash;
                }
            } else {
                // Default error message
                errorDiv.innerText = res.error; 
                
                if (res.code === 'USER_NOT_FOUND') {
                    // Show "User not registered" message and a Register button
                    errorDiv.innerHTML = `<span style="display:block; margin-bottom:5px;">${res.error}</span> 
                                          <a href="register.html" class="btn btn-primary" style="font-size:0.8rem; padding: 5px 15px;">Register Now</a>`;
                } else if (res.code === 'INVALID_PASSWORD') {
                    // Show specific message for wrong password
                     errorDiv.innerHTML = `<span style="font-weight:bold; display:block; margin-bottom:5px;">${res.error}</span>
                     <button type="button" class="btn btn-secondary" onclick="resetPassword()" style="font-size:0.8rem; padding: 5px 15px; background-color: #ff6b6b; color: white; border: none; cursor: pointer;">Try Again</button>`;
                }
            }
        });

        function resetPassword() {
            document.getElementById('password').value = '';
            document.getElementById('password').focus();
            document.getElementById('error-msg').innerText = '';
        }
    </script>
</body>
</html>
